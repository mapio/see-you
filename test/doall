#!/bin/bash -e

echocol() { echo -e "\033[32m*** $@...\033[0m"; }

if [ ! -r ./bin/tm ]; then
	echocol "mkdist tm"
	curdir=$(pwd)
	mkdir -p ./var/
	cd ./var
	git clone https://github.com/mapio/tristo-mietitore.git >/dev/null 2>&1
	cd tristo-mietitore
	./bin/mkdist
	mv ./bin/tm ../../bin
	cd ..
	rm -rf tristo-mietitore
	cd $curdir
fi

echocol mkdist
./bin/mkdist

tests="makefiles prepare"

for t in $tests; do
	echocol $t
	./test/$t
done
